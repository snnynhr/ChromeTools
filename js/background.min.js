console.log("Initiating background process");var cwl=localStorage.getItem("cookiesWL");null===cwl&&localStorage.setItem("cookiesWL",JSON.stringify([]));var hwl=localStorage.getItem("historyWL");null===hwl&&localStorage.setItem("historyWL",JSON.stringify([]));var s=localStorage.getItem("tabStack");null===s&&localStorage.setItem("tabStack",JSON.stringify([]));var ss=localStorage.getItem("sessionStack");null===ss&&localStorage.setItem("sessionStack",JSON.stringify([]));var c=localStorage.getItem("cookiesFlag");
null===c&&localStorage.setItem("cookiesFlag",1);var h=localStorage.getItem("historyFlag");null===h&&localStorage.setItem("historyFlag",1);var hd=localStorage.getItem("hd");null===hd&&localStorage.setItem("hd","on");var ytSize=localStorage.getItem("ytSize");null===ytSize&&localStorage.setItem("ytSize","1");var ytQuality=localStorage.getItem("ytQuality");null===ytQuality&&localStorage.setItem("ytQuality","highres");
chrome.tabs.query({},function(a){for(var d=[],b=0;b<a.length;b++){var e=a[b];d[d.length]=[e.id,e.windowId,e.index,e.url,e.active,e.pinned]}localStorage.setItem("chromeSession",JSON.stringify(d))});chrome.tabs.onCreated.addListener(function(a){curr=JSON.parse(localStorage.getItem("chromeSession"));curr[curr.length]=[a.id,a.windowId,a.index,a.url,a.active,a.pinned];console.log(curr);localStorage.setItem("chromeSession",JSON.stringify(curr))});
chrome.tabs.onRemoved.addListener(function(a,d){curr=JSON.parse(localStorage.getItem("chromeSession"));for(var b=0;b<curr.length;b++)if(curr[b][0]==a){curr.splice(b,1);break}console.log(curr);localStorage.setItem("chromeSession",JSON.stringify(curr))});
chrome.tabs.onUpdated.addListener(function(a,d,b){if(void 0!==d.url){console.log(a+" "+d.url);curr=JSON.parse(localStorage.getItem("chromeSession"));for(b=0;b<curr.length;b++)if(curr[b][0]==a){curr[b][3]=d.url;break}localStorage.setItem("chromeSession",JSON.stringify(curr))}});chrome.cookies.onChanged.addListener(function(a){"explicit"==a.cause&&localStorage.setItem("cookiesFlag",1)});chrome.history.onVisited.addListener(function(a){localStorage.setItem("historyFlag",1)});
chrome.runtime.onMessage.addListener(function(a,d,b){if("getSettings"==a.msg){a="on"==localStorage.getItem("hd")?"1":"0";d=localStorage.getItem("ytSize");var e=localStorage.getItem("ytQuality");b({ytQuality:e,ytSize:d,enabled:a})}else console.log(a.msg)});
